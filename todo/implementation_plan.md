# MCP Remote Server Go 実装計画

## 概要

TypeScript で実装された MCP リモートサーバーを Go 言語で再実装するプロジェクトです。mark3labs/mcp-go ライブラリを利用して、プロキシの機能を実装します。

## 実装ステップ

### 1. プロジェクト構造の設定

- [x] プロジェクトディレクトリ構造の作成
- [x] Go モジュールの初期化
- [x] 依存関係の設定 (mark3labs/mcp-go など)

```
mcp-remote-go/
├── cmd/
│   └── proxy/
│       └── main.go       # プロキシコマンドのエントリーポイント
├── internal/
│   ├── auth/
│   │   ├── coordinator.go    # 認証コーディネーション
│   │   ├── oauth.go          # OAuth クライアントプロバイダー
│   │   └── config.go         # 認証設定管理
│   ├── transport/
│   │   ├── transport.go      # トランスポートインターフェース
│   │   ├── sse.go            # SSE トランスポート実装
│   │   └── http.go           # HTTP トランスポート実装
│   └── utils/
│       ├── proxy.go          # プロキシユーティリティ
│       ├── args.go           # コマンドライン引数解析
│       └── signals.go        # シグナルハンドリング
├── pkg/
│   └── mcp/
│       └── client.go         # MCP クライアント
├── go.mod
├── go.sum
└── README.md
```

### 2. 基本的なデータ構造とインターフェースの実装

- [x] トランスポート戦略の定義
- [x] OAuth トークン構造体の定義
- [x] OAuth クライアント情報構造体の定義
- [x] ロックファイルデータ構造体の定義
- [x] トランスポートインターフェースの定義
- [x] OAuth クライアントプロバイダーインターフェースの定義
- [x] 認証コーディネーターインターフェースの定義

### 3. 認証関連の実装

- [x] OAuth クライアントプロバイダーの実装
  - [x] クライアント情報の保存と取得
  - [x] トークンの保存と取得
  - [x] 認証 URL へのリダイレクト
  - [x] PKCE コード検証子の管理
- [x] 認証設定管理の実装
  - [x] 設定ファイルパスの管理
  - [x] JSON ファイルの読み書き
  - [x] テキストファイルの読み書き
- [x] 認証コーディネーションの実装
  - [x] プロセス間の認証調整
  - [x] ロックファイルの管理
  - [x] 認証コールバックサーバーの設定

### 4. トランスポートの実装

- [x] SSE クライアントトランスポートの実装
  - [x] イベントソース接続の管理
  - [x] メッセージの送受信
  - [x] エラーハンドリング
- [x] HTTP クライアントトランスポートの実装
  - [x] HTTP 接続の管理
  - [x] メッセージの送受信
  - [x] エラーハンドリング
- [x] STDIO サーバートランスポートの実装
  - [x] 標準入出力の管理
  - [x] メッセージの送受信

### 5. ユーティリティの実装

- [x] トランスポート間のプロキシ設定
- [x] リモートサーバーへの接続処理
- [x] OAuth コールバックサーバーの設定
- [x] コマンドライン引数の解析
- [x] シグナルハンドラの設定
- [x] サーバー URL のハッシュ生成

### 6. プロキシコマンドの実装

- [x] プロキシコマンドの実装
  - [x] ローカル STDIO サーバーの設定
  - [x] リモートサーバーへの接続
  - [x] 双方向プロキシの設定

### 7. テストとドキュメント

- [ ] 単体テストの作成
- [ ] 統合テストの作成
- [x] README の作成
- [ ] 使用方法ドキュメントの作成

## mark3labs/mcp-go の利用方法

mark3labs/mcp-go ライブラリは主に MCP サーバーの実装に焦点を当てていますが、以下の機能を利用して MCP リモートサーバーを実装します：

1. **MCP クライアント機能**:
   - mark3labs/mcp-go のクライアント機能を拡張して、リモートサーバーとの通信を実装
   - 必要に応じて、独自のトランスポート層を実装

2. **認証機能**:
   - OAuth 認証フローを実装
   - mark3labs/mcp-go の認証関連機能を拡張

3. **トランスポート**:
   - SSE と HTTP トランスポートを実装
   - mark3labs/mcp-go の基本的なトランスポートインターフェースを拡張

4. **プロキシ機能**:
   - ローカル STDIO サーバーとリモートサーバー間のプロキシを実装
   - メッセージの変換と転送を処理

## 実装上の注意点

1. **互換性**:
   - TypeScript 実装との完全な互換性を維持
   - 同じコマンドライン引数とオプションをサポート

2. **エラーハンドリング**:
   - 認証エラーの適切な処理
   - トランスポートエラーの処理とフォールバック
   - プロセス間調整エラーの処理

3. **セキュリティ**:
   - トークンの安全な保存
   - PKCE の適切な実装

4. **パフォーマンス**:
   - ゴルーチンを使用した効率的な並行処理
   - リソースの適切な管理

## 実装スケジュール

1. **フェーズ 1: 基本構造とインターフェース** (2日)
   - プロジェクト構造の設定
   - 基本的なデータ構造とインターフェースの実装

2. **フェーズ 2: 認証とトランスポート** (3日)
   - 認証関連の実装
   - トランスポートの実装

3. **フェーズ 3: コマンド実装** (2日)
   - ユーティリティの実装
   - クライアントとプロキシコマンドの実装

4. **フェーズ 4: テストとドキュメント** (1日)
   - テストの作成
   - ドキュメントの作成

## 参考資料

- [mark3labs/mcp-go](https://github.com/mark3labs/mcp-go) - MCP の Go 実装
- [Model Context Protocol](https://modelcontextprotocol.io/) - MCP の公式ドキュメント
- [mcp-remote-ts](https://github.com/naotama2002/mcp-remote-go/tree/main/mcp-remote-ts) - TypeScript 実装
